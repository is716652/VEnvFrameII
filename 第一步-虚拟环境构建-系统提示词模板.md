# Python项目虚拟环境构建指南

## 项目基本信息

- 项目名称：VEnvFrame
- 根目录：VEnvFrame
- 描述：

## 虚拟环境配置

- 编程语言：Python
- Python版本：3.12.8（严格要求）
- 虚拟环境名称：VEnvFrame-Env
- 虚拟环境位置：项目根目录下

## 推荐：一键构建/补全虚拟环境

优先使用项目提供的自动脚本，确保精确使用 Python 3.12.8 并自动补全依赖。

### 0. 可选：编辑 venv_config.ini

项目根目录提供 venv_config.ini，可选配置：
- PYTHON312_HOME：Python 3.12.8 的安装目录（包含 python.exe）
- MIRROR：依赖安装镜像，支持 tsinghua/aliyun/douban/ustc/default

示例：
```
PYTHON312_HOME=C:\Python312
MIRROR=tsinghua
```

### 1. 一键构建/补全

在项目根目录执行：
```
./build_env.bat [mirror]
```
- mirror 可选：tsinghua | aliyun | douban | ustc | default（命令行参数优先级高于 venv_config.ini）
- 脚本特性：
  - 严格查找并仅使用 Python 3.12.8（优先读取 venv_config.ini 的 PYTHON312_HOME）
  - 若未找到，将尝试使用 package/python-3.12.8-amd64.exe 自动安装
  - 使用镜像参数进行 pip 安装，若镜像失败会自动回退到默认源重试
  - 如已有虚拟环境但版本不是 3.12.8，将自动重建

### 2. 激活虚拟环境

在项目根目录执行：
```
./activate_env.bat
```
- 启动后会自动校验当前环境 Python 版本是否为 3.12.8，并给出诊断信息
- 输出当前 Python 路径、版本、pip 信息、已安装包数量与列表

### 3. 验证依赖

激活后执行：
```
where python
python -c "import sys; print('Python路径:', sys.executable)"
python -m pip --version
python -m pip list | find /c /v ""
```

## 可选：手动方式（仅在了解严格版本要求时使用）

如确需手动操作，请确保使用的 Python 版本为 3.12.8：

### 1. 创建虚拟环境
```
python -m venv VEnvFrame-Env
```

### 2. 激活虚拟环境
- Windows (PowerShell):
```
./VEnvFrame-Env/Scripts/Activate.ps1
```
- Windows (CMD):
```
./VEnvFrame-Env/Scripts/activate.bat
```
- Linux/macOS:
```
source ./VEnvFrame-Env/bin/activate
```

### 3. 安装依赖包到虚拟环境
- 使用国内镜像源（例如清华源）
```
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```
- 或使用默认源：
```
pip install -r requirements.txt
```

## 项目开发规范

1. 所有开发工作必须在激活虚拟环境的状态下进行
2. 新增依赖包时，更新 requirements.txt：
   ```
   pip freeze > requirements.txt
   ```
3. 定期更新依赖包：
   ```
   pip install --upgrade -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
   ```

## 虚拟环境管理命令

- 激活：
```
./activate_env.bat
```
- 退出：
```
deactivate
```
- 删除：
```
Remove-Item -Recurse -Force ./VEnvFrame-Env
```

## 注意事项

### AI自动执行重要提醒

1. 激活验证：AI 执行时必须确认虚拟环境已正确激活（提示符含 (VEnvFrame-Env)）
2. 依赖位置：必须使用虚拟环境中的 pip 安装依赖，避免安装到系统 Python 环境
3. 安装验证：安装完成后验证依赖包是否正确安装到虚拟环境中
4. 路径确认：执行过程中多次确认 Python 和 pip 路径指向虚拟环境
5. 版本约束：本项目严格要求 Python 3.12.8，若不一致请运行 ./build_env.bat 重建

### 通用注意事项

1. 确保项目代码中不包含硬编码路径，保证可移植性
2. 将虚拟环境文件夹 (VEnvFrame-Env) 添加到 .gitignore
3. 团队协作中，确保所有成员使用相同 Python 版本（3.12.8）和依赖
4. 对于需要特定系统库的包，可能需要额外的系统级安装步骤

## 虚拟环境移植与修复

当项目需要移植到其他机器时，使用项目提供的自动修复工具：
- fix_venv_path.py（Python脚本，位于 Tools/）
- fix_venv_path.bat（推荐，Windows 批处理）
- fix_venv_path.ps1（Windows PowerShell）
- 虚拟环境移植指南.md（详细说明）

使用方法（项目根目录）：
```
# 推荐
./fix_venv_path.bat

# 或
python ./Tools/fix_venv_path.py
```
如仍存在缺包或版本不一致，运行：
```
./build_env.bat [mirror]
```
